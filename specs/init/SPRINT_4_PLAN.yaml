sprint: 4
goal: First Production Deployment
duration: 2-3 days
milestone: First public release with working admin panel and FAQ

sections:
  - name: Infrastructure Setup
    tasks:
      - id: choose-hosting-provider
        status: pending
        description: Select hosting provider and plan
        options:
          option_1_vercel:
            - "Vercel (recommended for Astro + Next.js/React)"
            - "Pros: Easy setup, great DX, automatic deployments, edge functions"
            - "Cons: Separate API deployment needed"
            - "Cost: Free tier available, then $20/month"
          option_2_railway:
            - "Railway (good for full-stack monorepo)"
            - "Pros: Easy Docker deployment, PostgreSQL included, monorepo-friendly"
            - "Cons: More expensive than Vercel"
            - "Cost: $5 starter + usage"
          option_3_digitalocean:
            - "DigitalOcean App Platform"
            - "Pros: Simple, PostgreSQL included, good pricing"
            - "Cons: Less automation than Vercel"
            - "Cost: $5-12/month"
          option_4_custom_vps:
            - "Custom VPS (DigitalOcean Droplet / Hetzner / etc.)"
            - "Pros: Full control, cheapest long-term"
            - "Cons: More setup and maintenance"
            - "Cost: $5-10/month"
        recommendation: |
          For this project, recommend Railway or DigitalOcean App Platform:
          - Both handle monorepo well
          - PostgreSQL included
          - Docker support
          - Affordable
          - Easy to scale later
      
      - id: setup-postgresql-database
        status: pending
        description: Set up production PostgreSQL database
        options:
          - Use hosting provider's managed PostgreSQL (recommended)
          - Separate database service (Neon, Supabase, etc.)
        steps:
          - Create production database instance
          - Note connection string (DATABASE_URL)
          - Enable SSL connections
          - Set up connection pooling if needed
          - Configure backup schedule (daily recommended)
      
      - id: setup-domain
        status: pending
        description: Configure domain and DNS
        steps:
          - Purchase domain (if not already owned)
          - Configure DNS records
          - Point domain to hosting provider
          - Set up www and root domain
        dns_records: |
          Example for Vercel/Railway:
          A     @        76.76.21.21
          CNAME www      cname.provider.com
          
          Or use nameservers provided by hosting

  - name: Environment Configuration
    tasks:
      - id: create-production-env
        status: pending
        description: Set up production environment variables
        file: .env.production (don't commit)
        required_vars:
          - DATABASE_URL=postgresql://user:password@host:5432/dbname
          - JWT_SECRET=<strong-random-secret-min-32-chars>
          - NODE_ENV=production
          - PUBLIC_API_URL=https://yourdomain.com/api
          - CORS_ORIGIN=https://yourdomain.com
        notes: |
          Generate JWT_SECRET with:
          node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
      
      - id: configure-hosting-secrets
        status: pending
        description: Add environment variables to hosting provider
        steps:
          - Access hosting provider dashboard
          - Navigate to environment variables / secrets
          - Add all required environment variables
          - Verify variables are set correctly
          - Restart services if needed

  - name: Database Migration
    tasks:
      - id: run-production-migrations
        status: pending
        description: Apply database migrations to production
        steps:
          - Set DATABASE_URL to production database
          - Run: cd libs/database && npx prisma migrate deploy
          - Verify migrations applied successfully
          - Check Prisma Client is generated
        notes: |
          Use "migrate deploy" not "migrate dev" in production.
          This applies migrations without prompting.
      
      - id: seed-production-data
        status: pending
        description: Seed production database with initial data
        steps:
          - Review seed.ts for production-appropriate data
          - Create production admin user
          - Add initial FAQ entries (optional)
          - Run: cd libs/database && npm run db:seed
        notes: |
          Consider creating a separate production seed script
          that only creates essential data (admin user).

  - name: Build & Deploy
    tasks:
      - id: configure-turborepo-build
        status: pending
        description: Configure build commands for production
        file: turbo.json
        verify:
          - Build command builds all packages in correct order
          - Admin app builds successfully
          - Public site builds successfully
          - API builds successfully
          - Check turbo.json has correct dependencies
        build_commands: |
          npm run build           # Builds all packages
          npm run build:api       # Just API
          npm run build:admin     # Just admin
          npm run build:public    # Just public site
      
      - id: setup-deployment-config
        status: pending
        description: Create deployment configuration
        railway_example: |
          # railway.toml
          [build]
          builder = "nixpacks"
          buildCommand = "npm install && npm run build"
          
          [deploy]
          startCommand = "npm run start:api"
          healthcheckPath = "/api/health"
          
          [[services]]
          name = "api"
          
          [[services]]
          name = "admin"
          
          [[services]]
          name = "public"
        
        vercel_example: |
          # vercel.json
          {
            "version": 2,
            "builds": [
              {
                "src": "packages/public/**",
                "use": "@vercel/static-build",
                "config": { "distDir": "dist" }
              },
              {
                "src": "packages/admin/**",
                "use": "@vercel/static-build",
                "config": { "distDir": "dist" }
              }
            ]
          }
          
          # Note: API would need separate deployment
      
      - id: deploy-api
        status: pending
        description: Deploy NestJS API
        steps:
          - Configure build and start commands
          - Set environment variables
          - Deploy API service
          - Verify health endpoint works
          - Check logs for errors
        health_endpoint: |
          Add health check endpoint to API:
          
          @Get('health')
          health() {
            return { status: 'ok', timestamp: new Date().toISOString() };
          }
      
      - id: deploy-admin-app
        status: pending
        description: Deploy React admin app
        steps:
          - Build admin app with production API URL
          - Configure Vite for production
          - Deploy to hosting
          - Verify app loads correctly
          - Test login functionality
          - Check API calls work
        vite_config: |
          // vite.config.ts - production
          export default defineConfig({
            base: '/admin/',  // If deploying to subdirectory
            build: {
              outDir: 'dist',
              sourcemap: false,  // Optional: disable for prod
            },
          });
      
      - id: deploy-public-site
        status: pending
        description: Deploy Astro public site
        steps:
          - Build public site with production API URL
          - Configure Astro for production
          - Deploy to hosting
          - Verify site loads correctly
          - Test FAQ page
          - Check SEO meta tags
        astro_config: |
          // astro.config.mjs
          export default defineConfig({
            site: 'https://yourdomain.com',
            output: 'static',  // or 'server' if using SSR
          });

  - name: SSL & Security
    tasks:
      - id: setup-ssl-certificates
        status: pending
        description: Configure SSL/HTTPS
        steps:
          - Most hosting providers auto-provision SSL (Let's Encrypt)
          - Verify HTTPS works on all domains
          - Force HTTPS redirects
          - Check certificate validity
        notes: |
          Vercel, Railway, DigitalOcean all provide automatic SSL.
          For custom VPS, use Certbot with Let's Encrypt.
      
      - id: configure-cors
        status: pending
        description: Set up CORS for production
        file: apps/api/src/main.ts
        update: |
          app.enableCors({
            origin: [
              process.env.PUBLIC_SITE_URL,      // https://yourdomain.com
              process.env.ADMIN_SITE_URL,       // https://yourdomain.com/admin
            ],
            credentials: true,
          });
      
      - id: security-headers
        status: pending
        description: Add security headers
        headers_to_add:
          - X-Frame-Options: DENY
          - X-Content-Type-Options: nosniff
          - Referrer-Policy: strict-origin-when-cross-origin
          - Permissions-Policy: geolocation=(), microphone=(), camera=()
        nestjs_example: |
          // main.ts
          import helmet from 'helmet';
          app.use(helmet());
        
        vercel_example: |
          // vercel.json
          {
            "headers": [
              {
                "source": "/(.*)",
                "headers": [
                  { "key": "X-Frame-Options", "value": "DENY" },
                  { "key": "X-Content-Type-Options", "value": "nosniff" }
                ]
              }
            ]
          }

  - name: Monitoring & Logging
    tasks:
      - id: setup-logging
        status: pending
        description: Configure production logging
        options:
          - Built-in hosting provider logs (start here)
          - External service: Logtail, Papertrail, etc.
        steps:
          - Configure NestJS logger for production
          - Set up log levels (error, warn, info)
          - Test log collection
          - Set up log alerts for errors
        nestjs_logger: |
          // main.ts
          const app = await NestFactory.create(AppModule, {
            logger: ['error', 'warn', 'log'],  // Production logging
          });
      
      - id: setup-error-tracking
        status: pending
        description: Set up error tracking (optional but recommended)
        options:
          - Sentry (recommended - generous free tier)
          - Rollbar
          - Built-in hosting logs
        sentry_setup: |
          npm install @sentry/node @sentry/nestjs
          
          // main.ts
          import * as Sentry from '@sentry/nestjs';
          
          Sentry.init({
            dsn: process.env.SENTRY_DSN,
            environment: process.env.NODE_ENV,
          });
        notes: |
          Sentry is optional but very helpful for catching production errors.
          Free tier: 5,000 errors/month.
      
      - id: setup-uptime-monitoring
        status: pending
        description: Set up uptime monitoring
        options:
          - UptimeRobot (free, simple)
          - Pingdom
          - Hosting provider built-in
        uptimerobot_setup:
          - Create free account at uptimerobot.com
          - Add monitor for https://yourdomain.com
          - Add monitor for https://yourdomain.com/api/health
          - Set up email alerts
          - Check interval: 5 minutes

  - name: Testing & Validation
    tasks:
      - id: smoke-test-api
        status: pending
        description: Verify API endpoints work in production
        tests:
          - GET /api/health - Should return 200
          - POST /api/auth/login - Should authenticate
          - GET /api/auth/me - Should return user with valid token
          - GET /api/faq - Should return FAQs
          - POST /api/faq (admin) - Should create FAQ
        tools: |
          Use Postman, curl, or Thunder Client to test:
          
          curl https://yourdomain.com/api/health
          curl https://yourdomain.com/api/faq
      
      - id: smoke-test-admin
        status: pending
        description: Verify admin app works in production
        tests:
          - Load admin page
          - Login with admin credentials
          - Navigate to dashboard
          - Navigate to FAQ management
          - Create/edit/delete FAQ
          - Logout
        check:
          - No console errors
          - API calls work
          - Token stored correctly
          - Routes work correctly
      
      - id: smoke-test-public-site
        status: pending
        description: Verify public site works in production
        tests:
          - Load homepage
          - Navigate to FAQ page
          - Verify FAQ content displays
          - Test responsive design on mobile
          - Check page load speed
        check:
          - No console errors
          - Images load correctly
          - SEO meta tags present
          - Lighthouse score > 90
      
      - id: test-database-connection
        status: pending
        description: Verify database connectivity
        verify:
          - API can connect to database
          - Queries execute successfully
          - No connection pool errors
          - Check logs for database warnings
      
      - id: performance-testing
        status: pending
        description: Test production performance
        tools:
          - Lighthouse (Chrome DevTools)
          - PageSpeed Insights
          - GTmetrix
        targets:
          - Performance score: > 90
          - First Contentful Paint: < 1.5s
          - Time to Interactive: < 3s
          - API response time: < 200ms
        steps:
          - Run Lighthouse on homepage
          - Run Lighthouse on FAQ page
          - Test API endpoint response times
          - Check bundle sizes

  - name: Documentation
    tasks:
      - id: document-deployment
        status: pending
        description: Document deployment process
        file: DEPLOYMENT.md
        include:
          - Hosting provider details
          - Deployment commands
          - Environment variables needed
          - Database connection details
          - Troubleshooting common issues
      
      - id: document-admin-credentials
        status: pending
        description: Securely store admin credentials
        steps:
          - Use password manager (1Password, Bitwarden, etc.)
          - Store admin email and password
          - Store database credentials
          - Store hosting provider credentials
          - Store domain registrar credentials
        security: |
          NEVER commit credentials to git.
          Use strong, unique passwords.
          Enable 2FA where available.
      
      - id: create-runbook
        status: pending
        description: Create operational runbook
        file: RUNBOOK.md
        include:
          - How to deploy updates
          - How to roll back deployments
          - How to check logs
          - How to access database
          - Emergency contacts
          - Common troubleshooting steps

  - name: Post-Deployment
    tasks:
      - id: setup-backups
        status: pending
        description: Configure automated database backups
        steps:
          - Enable automatic backups on hosting provider
          - Set backup retention (7-30 days recommended)
          - Test backup restoration process
          - Document restore procedure
        notes: |
          Most managed database services include automatic backups.
          Verify backup schedule and retention policy.
      
      - id: setup-cdn
        status: pending
        description: Configure CDN for static assets (optional)
        options:
          - Cloudflare (free tier available)
          - Built-in hosting CDN
        benefits:
          - Faster asset delivery
          - DDoS protection
          - Cache static content
        notes: |
          Many hosting providers (Vercel, Railway) include CDN.
          Additional Cloudflare layer optional but recommended.
      
      - id: announce-launch
        status: pending
        description: Announce the launch
        checklist:
          - Notify stakeholders
          - Share link with client/business owner
          - Gather initial feedback
          - Monitor for issues closely for first 24-48 hours

validation:
  - [ ] Domain accessible via HTTPS
  - [ ] SSL certificate valid
  - [ ] Public site loads correctly
  - [ ] Admin app loads and login works
  - [ ] API health endpoint responds
  - [ ] Database connected and migrations applied
  - [ ] FAQ page displays content
  - [ ] Admin can create/edit FAQs
  - [ ] No console errors on any page
  - [ ] Lighthouse score > 90
  - [ ] Uptime monitoring configured
  - [ ] Backups configured
  - [ ] Documentation complete

deployment_checklist:
  infrastructure:
    - [ ] Hosting provider selected
    - [ ] Domain configured and pointing to hosting
    - [ ] PostgreSQL database provisioned
    - [ ] SSL certificates active
  
  configuration:
    - [ ] All environment variables set
    - [ ] JWT secret generated and set
    - [ ] CORS configured for production domains
    - [ ] Security headers configured
  
  database:
    - [ ] Migrations applied to production
    - [ ] Admin user seeded
    - [ ] Database backups enabled
  
  deployment:
    - [ ] API deployed and responding
    - [ ] Admin app deployed and accessible
    - [ ] Public site deployed and accessible
    - [ ] All services communicate correctly
  
  testing:
    - [ ] Smoke tests passed
    - [ ] Performance tests passed
    - [ ] Mobile responsiveness verified
    - [ ] Cross-browser testing done
  
  monitoring:
    - [ ] Logging configured
    - [ ] Error tracking set up (optional)
    - [ ] Uptime monitoring active
  
  documentation:
    - [ ] Deployment docs written
    - [ ] Credentials securely stored
    - [ ] Runbook created

time_estimate:
  - Infrastructure setup: 2-3 hours
  - Environment configuration: 1 hour
  - Database migration: 30 min
  - Build & deploy: 2-3 hours
  - SSL & security: 1 hour
  - Monitoring setup: 1-2 hours
  - Testing & validation: 2-3 hours
  - Documentation: 1-2 hours
  - Buffer for issues: 2-4 hours
  - Total: 13-19 hours (2-3 days)

notes:
  - This is the first deployment - expect some troubleshooting
  - Railway or DigitalOcean App Platform recommended for ease
  - Most hosting providers handle SSL automatically
  - Keep deployment simple - avoid over-engineering
  - Monitor closely for first 24-48 hours after launch
  - Document everything as you go
  - Test thoroughly before announcing launch
  - Have rollback plan ready (keep previous version accessible)
  - Consider deploying to staging first
  - Use strong passwords and enable 2FA
  - Never commit secrets to git

recommended_stack:
  hosting: Railway or DigitalOcean App Platform
  database: Provider's managed PostgreSQL
  monitoring: UptimeRobot (free)
  error_tracking: Sentry (free tier)
  cdn: Included with hosting provider
  ssl: Automatic with hosting provider
  
  monthly_cost_estimate:
    railway: "$5-15 (starter + usage)"
    digital_ocean: "$12-20 (basic + database)"
    domain: "$10-15/year"
    total: "$15-35/month to start"

success_criteria:
  - Website accessible at custom domain with HTTPS
  - Admin can log in and manage FAQs
  - Public can view FAQ page
  - Site loads fast (Lighthouse > 90)
  - No critical errors in logs
  - Uptime monitoring active
  - Backups configured
  - Client/stakeholder approval received

